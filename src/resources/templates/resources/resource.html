{% extends "resources/base.html" %}
{% load i18n %}
{% load texttools %}
{% load threadedcommentstags %}

{% block extra_head %}
<script src="{{MEDIA_URL}}js/jquery-1.3.2.js" type="text/javascript"></script>
<script type="text/javascript">
function show_reply_form(comment_id, url, person_name) {

    var comment_reply = $('#' + comment_id);
    
    var pname = '';
    if (person_name) {
        pname = '<p>Reply to ' + person_name + ':</p>'
    }
    
    var to_add = $( new Array(
    '<div class="">' + pname,
    '<form method="POST" action="' + url + '">',
    '<ul>',  '<label for="id_comment">Kommentar:</label><textarea id="id_comment" name="comment" cols="40" rows="10"></textarea>',
    '<li><input type="submit" value="Submit Comment" /></li>',
    '</ul>', '</form>', '</div>').join(''));
    
    to_add.css("display", "none");
    comment_reply.after(to_add);
    
    to_add.slideDown(function() {
        comment_reply.replaceWith(new Array('<a id="',
        comment_id,'" href="javascript:hide_reply_form(\'',
        comment_id, '\',\'', url, '\',\'', person_name,
        '\')">Cancel</a>').join(''));
    });
}
function hide_reply_form(comment_id, url, person_name) {

    var comment_reply = $('#' + comment_id);
    
    comment_reply.next().slideUp(function (){
        comment_reply.next('.response').remove();
        comment_reply.replaceWith(new Array('<a id="',
        comment_id,'" href="javascript:show_reply_form(\'',
        comment_id, '\',\'', url, '\',\'', person_name,
        '\')">Reply</a>').join(''));
    });
}
</script>
{% endblock %}

{% block title %}Vivir Bien: {{ resource.name }}{% endblock %}

{% block resources_content %}
{% include "resources/includes/actions.html" %}
<div class="resource-details">
<h1>{{ resource.name }}</h1>
<table class="tags-table">
{% for tag in resource.tags.all %}
<tr><td>{{ tag.key }}
{% include "resources/includes/tag_actions.html" %}
</td><td>{{ tag.value|urlize }}
{# <a class="action" href="{% url wiki_article title=tag.get_tag|prefix:"Tag:" %}">?</a> #}
{% ifequal tag.value|wordcount 1 %}
<a class="action" href="{% url resources_with_tag key=tag.key value=tag.value|urlencode %}" title="{% trans "Resources with tag:" %} {{ tag.key }} = {{ tag.value }}">:</a>
{% endifequal %}
</td></li>
{% endfor %}
</table>
</div>

<div class="actions">
{% if perms.resources.edit_resource or perms.resources.add_tag %}
<a href="{% url resources_edit key=resource.shortname %}">{% trans "Edit" %}</a>
{% endif %}
</div>

{% get_threaded_comment_tree for resource as tree %}
<h2>{% trans "Comments for" %} {{ resource.name }}</h2>
{% if tree %}
<div class="comments">
{% for comment in tree %}
    <div style="margin-left: {{ comment.depth }}em;" class="comment">
        <h3>{% trans "Comment by" %} {{ comment.user.username }}:</h3>
        {{ comment.comment|linebreaks }}
        <a class="action" id="c{{ comment.id }}" href="javascript:show_reply_form('c{{ comment.id }}','{% get_comment_url resource comment %}','{{ comment.user.username }}')">{% trans "Reply" %}</a>
    </div>
{% endfor %}
</div>
{% endif %}
<div class="actions">
<a id="newcomment" href="javascript:show_reply_form('newcomment','{% get_comment_url resource %}')">{% trans "New Comment" %}</a>
</div>

{% endblock %}