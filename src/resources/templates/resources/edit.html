{% extends "resources/base.html" %}
{% load i18n %}

{% block extra_head %}
<script src="{{MEDIA_URL}}js/jquery-1.3.2.js" type="text/javascript"></script>
<script src="{{MEDIA_URL}}js/urlify.js" type="text/javascript"></script>
{{ form.media }}
{{ formset.media }}

<script type="text/javascript">

var editor_lookup = {
    'location': 'Location widget'
}

jQuery(function($) {
    $('#id_shortname').change(function() {
        this._dirty = true;
    });
    $('#id_name').keyup(function() {
        var el = $('#id_shortname');
        if (! el[0]._dirty) {
            el.val(URLify($(this).val(), 100));
        }
    });
    
    $('input[type=text][id$=-key]').change(function() {
        var key_field = $(this);
        var key = key_field.val();
                
        var widget = editor_lookup[key];
        if (widget) {
	        var value_field_id = this.id.substring(0, this.id.indexOf('-key')) + '-value';
	        var value_field = $('#' + value_field_id);
	        
	        value_field.after('<div class="value-widget">' + widget + '</div>');           
            //value_field.css({'display': 'none'});
        }
    });
    
});
</script>
{% endblock %}

{% block resources_content %}
{% include "resources/includes/actions.html" %}
{% if resource %}
<h1>{{ resource.name }}</h1>
{% else %}
<h1>{% trans "New resource" %}</h1>
{% endif %}

<form method="post" action="{% url resources_edit key=resource.shortname %}" autocomplete="off">
<table>
{{ form.as_table }}
</table>

{% if formset %}
{{ formset.management_form }}
<table>
{% for form in formset.forms %}
{% if forloop.first %}
<tr>
{% for field in form.visible_fields %}
        <th>{{ field.label }}</th>
{% endfor %}
</tr>
{% endif %}
<tr>
    {% for field in form.visible_fields %}
        <td>{{field.errors}}{{ field }}</td>
    {% endfor %}
    <td class="hidden">
    {% for field in form.hidden_fields %}
        {% if field.is_hidden %} {{ field }} {% endif %}
    {% endfor %}
    </td>
</tr>
{% endfor %}
</table>
{% endif %}

{% if tag_help %}
<div class="actions">
{% trans "Help:" %} 
{% for link in tag_help %}
<a href="{{link.1}}">{{link.0}}</a>
{% if not forloop.last %} | {% endif %}
{% endfor %}
</div>
{% endif %}

<button type="submit">{% trans "Save" %}</button>
<button name="action" value="add_tag" type="submit">{% trans "Save and continue" %}</button>

{% if resource %}
<a class="action" href="{% url resources_resource key=resource.shortname %}">{% trans "Cancel" %}</a>
{% else %}
<a class="action" href="{% url resources_list %}">{% trans "Cancel" %}</a>
{% endif %}

</form>
{% endblock %}